## 기본

react는 jsx를 지원하며, 가상 dom을 사용해 변경된 부분적 dom만 업데이트하는 ui 프레임워크.

fiber는 react 16 버전부터 채택된 리액트의 코어 아키텍쳐.

브라우저 dom 엘리먼트와 달리, react 엘리먼트는 일반 객체(plain object)이므로 쉽게 생성할 수 있다.
<br>react dom은 react 엘리먼트와 일치하도록 dom을 업데이트한다.

- jsx로 선언된 표현식은 react 엘리먼트라는 객체로 치환됨
- react 엘리먼트는 클래스 인스턴스가 아니라 일반 객체.

### 변경된 부분만 업데이트

react dom은 업데이트 시 변경된 부분만 native dom에 반영.

- react 내부의 비교 알고리즘을 사용해 dom 트리 변경을 줄이고, 퍼포먼스 향상을 꾀함.

n개의 엘리먼트를 가지는 트리를 다른 트리로 변환하는 알고리즘의 복잡도는 O(n^3).
<br>아래 2가지 가정을 통해 react는 O(n)인 휴리스틱 알고리즘을 재조정(reconciliation)에 사용한다.

- 엘리먼트마다 타입을 가진다. => 서로 다른 타입을 가진 엘리먼트는 서로 다른 트리를 생성한다. => `이전과 비교해 다른 타입의 react 엘리먼트로 변경되었다면, 하위트리를 비교하지 않고 전체를 교체한다.`
- key prop이 없다면 index를 기반으로 한다. key prop 사용을 권장한다. => `key prop을 통해 자식 요소 중 렌더링해야 할 자식과 그렇지 않을 자식을 구분한다.`

### ref 바람직한 사용 사례

react에서 컨트롤 가능한 태그 이름, 어트리뷰트, 자식이 아니라 native DOM API 등을 직접 컨트롤해야 할 때, ref를 사용한다.

- 포커스, 텍스트 선택 영역, 혹은 미디어의 재생을 관리할 때
- 애니메이션을 직접 실행시킬 때
- 서드 파티 DOM 라이브러리를 React와 같이 사용할 때

React는 JSX 표현식이 치환된 React 엘리먼트의 props, states를 통해 React DOM을 갱신하므로, Ref를 통해 native DOM을 직접 조작하면 이 변경 사항을 React가 유지할 수 없기 때문이다.

### virtual DOM과 internals

virtual DOM (VDOM)은 UI의 이상적인 또는 “가상”적인 표현을 메모리에 저장하고 React DOM과 같은 라이브러리에 의해 “실제” DOM과 동기화하는 프로그래밍 개념. 이 과정을 재조정이라 한다.

React 내부에는 native DOM과 동기화하기 위한 가상의 virtual DOM이 존재한다.

- virtual DOM은 이름 그대로 react 내부에 존재하는 어떤 구체적인 인스턴스나 값은 아니다. react가 react 엘리먼트와 native DOM을 동기화하기 위한 패턴의 이름 정도.

리액트 공식 문서에서는 파이버 재조정에 대한 공식 설명은 없으며, 코어 팀 Andrew Clark이 작성한 문서 정도만 존재.

- [react-fiber-architecture](https://github.com/acdlite/react-fiber-architecture)

### react가 하는 일

react는 jsx로 작성된 react 엘리먼트를 html 엘리먼트로 변환하여 DOM에 렌더링한다.
<br>변경이 발생했을 때, 정확히 변경된 부분만 파악해 적용한다.

- 어트리뷰트나 값의 변경 등은 핀 포인트로 적용하고, 엘리먼트 타입의 변경은 하위 트리 전체를 변경한다.

## react 말고, 프론트엔드 전반을 둘러싼 배경 지식

### 모니터의 주사율

브라우저의 js 엔진은 싱글 스레드.
<br>js 스레드가 코드를 실행하는 중에는 브라우저는 ui 업데이트 불가능하다.

현대 일반적인 모니터는 초당 60회 주기로 화면을 갱신한다.
<br>한번 화면을 갱신하고, 그 다음까지 1/60초(16ms)가 걸린다.

우리가 작성한 어떤 코드가 16ms 이상 걸린다면, 모니터의 주사율을 따라갈 수 없게 되어 버벅인다.
<br>이를 극복하려면, 개발자가 코드의 동시성을 적절히 조절해야 했다.

react 파이버 구조에서는 ui 갱신 작업 단위를 작은 단위로 쪼개, 내부적으로 스케쥴링함으로써 대규모 ui 갱신에도 16ms를 초과하지 않도록 한다.

### 동시성 스케쥴링

리액트의 파이버가 기존 스택 재조정자와 근본적으로 다른 점은 동시성이다.
<br>dom 업데이트, 렌더링 로직을 작업 단위로 구분하고 이를 비동기로 실행해 최대 실행 시간이 16ms를 넘지 않도록 제어한다.

파이버는 단순히 작업을 chunk로 분리하여 실행 시간만을 관리하는 것이 아니라 작업의 유형에 따라 우선순위를 부여하고, 기존에 수행 중인 작업보다 더 우선순위가 높은 작업이 인입될 경우 기존의 작업을 일시 중단하고 인입된 작업을 처리 후 다시 돌아오는 기능이 있다.

## react 동작 단계

react 내부 동작

- render 단계 : jsx 선언 또는 React.createElement()를 통해 일반객체인 react 엘리먼트 생성
- reconcile 단계 : 이전에 렌더링된 실제 dom 트리와 새로 렌더링할 react 엘리먼트를 비교해 변경점을 적용
- commit 단계 : 새로운 dom 엘리먼트를 브라우저 view에 commit한다.
- update 단계 : props, state 변경 시 해당 컴포넌트와 하위 컴포넌트에 대해 위 과정 반복

일반적으로 생각하는 dom 렌더링 동작은 react 내에서는 commit이며,
<br>react에서의 렌더링이란 react 엘리먼트를 생성하는 것으로 여겨진다.

### 루트 생성
